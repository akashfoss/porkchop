#!/usr/bin/env python

from BaseHTTPServer import HTTPServer
from optparse import OptionParser
import os, sys

loadpath = os.path.dirname(os.path.abspath(__file__)) + '/../lib'
if loadpath not in sys.path:
  sys.path.insert(0, loadpath)

from porkchop import *
from server import GetHandler

PLUGIN_DIR = '/usr/share/porkchop/plugins'
LISTEN_PORT = 5000

parser = OptionParser()
parser.add_option('--plugindir', dest='plugindir',
                  default=PLUGIN_DIR,
                  help='Load plugins from DIR', metavar='DIR')
parser.add_option('-p', type="int", dest='listen_port',
                  default=LISTEN_PORT,
                  help='Bind to PORT', metavar='PORT')

(options, args) = parser.parse_args()

if __name__ == '__main__':
  loader = PorkchopPluginLoader()
  plugins = loader.plugins(options.plugindir)

  server = HTTPServer(('', options.listen_port), GetHandler)
  print 'Starting server, use <Ctrl-C> to stop'
  server.serve_forever()
